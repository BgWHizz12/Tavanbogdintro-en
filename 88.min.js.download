(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{193:function(e,t,n){"use strict";n.r(t),n.d(t,"SurveyDefault",(function(){return C}));var i,s=n(13),a=n(3),r=n(91),o=n(7),l=n(4),c=n(83),u=n(8),_=n(2);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=g(e);if(t){var s=g(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return T(this,n)}}function T(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?b(e):t}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(h,e);var t,n,i,a=S(h);function h(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(n=a.call(this,e,t)).isIphone_=n.store_.state.isIphone,n.osQuestions_=[],n.filteredPanels_=[],n.currentQuestion_=0,n.form_=null,n.isEnabled_=!1,n.isStarted_=!1,n.wasSubmitted_=!1,n.alertElement_=null,n.nextBtn_=null,n.backBtn_=null,n.currentPanel_=null,n.currentPanelConfig_={},n.currentPanelFilled_=null,n.currentInputs_=[],n.panelContainer_=null,n.previousPanel_=null,n.nextPanel_=null,n.configAnalytics_=Object(o.a)(n.element,"data-g-config"),n.moduleName_=n.configAnalytics_.moduleName||"",n.currentSelectedInputs_=[],n.baseConfigAnalytics_={eventCategory:I.SURVEY_NAME,moduleName:n.moduleName_},n.panelIndex_=0,n.indexQuestionList_=[],n.indexQuestion_=0,n.panelsLength_=0,n.dao_=c.a.get("short-term"),n.xhr_=null,n.formData_=null,n.submitRetries_=n.config_.retries||0,n.version_=n.config_.version,n.expireInMonths_=n.config_.expireInMonths,n.registerSurvey_=n.registerSurvey_.bind(b(n)),n.enableSurvey_=n.enableSurvey_.bind(b(n)),n.onKeydown_=n.onKeydown_.bind(b(n)),n.handleCloseSurveyAnalytics_=n.handleCloseSurveyAnalytics_.bind(b(n)),n.closeSurvey_=n.closeSurvey_.bind(b(n)),n.handleReadyStateChange_=n.handleReadyStateChange_.bind(b(n)),n}return t=h,(n=[{key:"initialize_",value:function(){var e=this;this.getSurveyElements_(),this.dao_.read(this.getSurveyCookieKey())||(this.filterPanelsForCurrentOS_(),this.setCounters_(),this.nextPanel_=this.filteredPanels_[this.currentQuestion_+1],this.events=E({},"click ".concat(m.PANEL_SUBMITTED_CTA),(function(){e.closeSurvey_(e.config_.id)})),this.nextBtn_.addEventListener("click",(function(t){return e.changePanel_(t)})),this.backBtn_.addEventListener("click",(function(t){e.changePanel_(t,!1),e.handBackEventAnalytics_()})),this.subscriptions_=[[this.topics_.SHOW_SURVEY,this.enableSurvey_],[this.topics_.CLOSE_SURVEY,this.closeSurvey_]],this.updatePanel_(),this.setUiClass_(),this.panelsLength_=y(this.element.querySelectorAll(m.SURVEY_PANEL)).length,this.indexQuestionList_=this.config_.indexQuestionList||[],this.registerSurvey_())}},{key:"registerSurvey_",value:function(){this.store_.dispatch(this.topics_.REGISTER_SURVEY,{id:this.config_.id,data:this.config_.data}),this.handleLaunchForAnalytics_(0)}},{key:"getSurveyElements_",value:function(){this.form_=this.element.querySelector(m.FORM),this.alertElement_=this.element.querySelector(m.ALERT),this.nextBtn_=this.element.querySelector(m.NEXT),this.backBtn_=this.element.querySelector(m.BACK),this.panelContainer_=this.element.querySelector(m.PANEL_CONTAINER),this.startPanel_=this.element.querySelector(m.START),this.endPanel_=this.element.querySelector(m.END),this.currentPanel_=this.element.querySelector(m.PANEL_VISIBLE),this.currentPanelConfig_=Object(o.a)(this.currentPanel_,"data-p-config"),this.currentPanelFilled_=Object(o.a)(this.currentPanel_,"data-p-filled"),this.allQuestions_=this.element.querySelectorAll(m.QUESTIONS)}},{key:"filterPanelsForCurrentOS_",value:function(){var e=this,t=Array.from(this.allQuestions_);this.osQuestions_=y(t.filter((function(t){var n=e.currentOs_,i=t.dataset.osVisibility;return JSON.parse(i).includes(n)}))),this.filteredPanels_=[this.startPanel_].concat(y(this.osQuestions_),[this.endPanel_])}},{key:"setCounters_",value:function(){var e=this;this.osQuestions_.forEach((function(t,n){var i=t.querySelector(m.COUNTER),s=t.querySelector(m.TOTAL);i.innerText=n+1,s.innerText=e.osQuestions_.length}))}},{key:"enableSurvey_",value:function(e){e===this.config_.id&&(this.isEnabled_=!0)}},{key:"changePanel_",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.preventDefault(),this.isEnabled_)if(this.currentSelectedInputs_=this.getSelectedInputs_(),this.handlePanelAnalytics_(),!n&&this.currentPanelConfig_.ctas.back.action===I.CLOSE||n&&this.currentPanelConfig_.ctas.next.action===I.CLOSE)this.closeSurvey_(this.config_.id);else if(n||this.currentPanelConfig_.ctas.back.action!==I.DECLINE)if(!n||this.currentPanelFilled_){var i=600,a=this.currentPanel_;this.alertElement_.classList.remove(P.VISIBLE),this.panelContainer_.classList.add(P.FADE),this.setUiClass_(!1),this.currentPanelConfig_.submit&&n&&(this.sendData_(),this.handleCompleteSurveyAnalytics_()),this.currentPanel_=n?this.nextPanel_:this.previousPanel_,this.currentQuestion_=n?this.currentQuestion_+1:this.currentQuestion_-1,this.currentPanelConfig_=Object(o.a)(this.currentPanel_,"data-p-config"),this.currentPanelFilled_=Object(o.a)(this.currentPanel_,"data-p-filled"),this.currentInputs_=y(this.currentPanel_.querySelectorAll(m.INPUT)),this.currentTextAreas_=y(this.currentPanel_.querySelectorAll("".concat(m.TEXTAREA).concat(m.FIELD_TEXTAREA))),this.nextPanel_=this.filteredPanels_[this.currentQuestion_+1],this.previousPanel_=this.filteredPanels_[this.currentQuestion_-1],s.a.requestTimeout((function(){t.currentPanelConfig_.centered?t.panelContainer_.classList.add(P.CENTERED):t.panelContainer_.classList.remove(P.CENTERED),a.classList.remove(P.VISIBLE),t.currentPanel_.classList.add(P.VISIBLE),t.panelContainer_.classList.remove(P.FADE)}),i),this.setUiClass_(),this.updatePanel_(),this.handlePanelFilled_(),this.nextBtn_.blur()}else this.alertElement_.classList.add(P.VISIBLE);else{var r={eventLabel:I.DECLINE};this.closeSurvey_(this.config_.id,r)}}},{key:"updatePanel_",value:function(){this.isStarted_||"full-height"!==this.currentPanelConfig_.type||(this.isStarted_=!0,this.element.classList.add(P.FULL_HEIGHT),this.store_.dispatch(this.topics_.START_SURVEY,{id:this.config_.id}),document.addEventListener("keydown",this.onKeydown_)),this.updateCta_(this.nextBtn_,this.currentPanelConfig_.ctas.next),this.updateCta_(this.backBtn_,this.currentPanelConfig_.ctas.back),this.enableCurrentInputs_(),this.setInputListeners_(),this.panelIndex_=this.currentPanelConfig_.index}},{key:"closeSurvey_",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e===this.config_.id&&this.isEnabled_&&(this.isEnabled_=!1,this.element.classList.remove(P.FULL_HEIGHT),document.removeEventListener("keydown",this.onKeydown_),this.store_.dispatch(this.topics_.CLOSE_SURVEY,{id:this.config_.id}),this.optoutUser_(),this.handleCloseSurveyAnalytics_(t,this.config_.id))}},{key:"setUiClass_",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?this.element.classList.add("".concat(P.SURVEY_UI,"-").concat(this.currentPanel_.dataset.panel)):this.element.classList.remove("".concat(P.SURVEY_UI,"-").concat(this.currentPanel_.dataset.panel))}},{key:"onKeydown_",value:function(e){e.keyCode===r.a.ESC&&this.closeSurvey_(this.config_.id)}},{key:"updateCta_",value:function(e,t){var n=e.querySelector("span")||e;t.display?(e.classList.remove(P.HIDDEN),e.tabIndex=0):(e.classList.add(P.HIDDEN),e.tabIndex=-1),n.innerText=t.text}},{key:"setInputListeners_",value:function(){var e=this;this.currentInputs_.forEach((function(t){t.addEventListener("change",(function(){e.handlePanelFilled_()}))}))}},{key:"getSelectedInputs_",value:function(){return this.currentInputs_.filter((function(e){return!0===e.checked}))}},{key:"handleLaunchForAnalytics_",value:function(e){if(this.isEnabled_){var t=Object(o.a)(this.element,"data-g-config"),n=this.nextPanel_.getAttribute("data-p-label"),i=this.indexQuestionList_[e]||e;0!==e&&e!==this.panelsLength_-1&&(t.eventLabel="".concat(i,"-").concat(n," "),t.eventAction=this.getStepVersion_(I.STEP_VIEW),this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:t,id:u.a.AUTOMATED_INTERACTION}))}}},{key:"handleSelectedInputsAnalytics_",value:function(){var e;if((!(this.panelIndex_>0&&this.panelIndex_<this.panelsLength_)||this.currentSelectedInputs_)&&this.currentTextAreas_&&(e=this.currentSelectedInputs_.length>0?this.currentSelectedInputs_.map((function(e){return e.value.split(":")[0]})).join("|").trim():this.currentTextAreas_.length>0?I.OPEN_TEXT_FIELD:"")){var t={eventAction:this.getStepVersion_(I.STEP_COMPLETE),eventLabel:"".concat(this.indexQuestion_,"-").concat(e)};this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:f(f({},this.baseConfigAnalytics_),t),id:u.a.AUTOMATED_INTERACTION})}}},{key:"getStepVersion_",value:function(e){return"".concat(I.SITE," ").concat(this.analyticVersion_," - ").concat(e)}},{key:"setCloseConfigAnalytics_",value:function(e){var t=this.setCloseDataAnalytics_();e.setAttribute("data-g-config",JSON.stringify(t))}},{key:"handleCloseSurveyAnalytics_",value:function(e,t){var n=f(f({},this.setCloseDataAnalytics_()),e);this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:n,id:u.a.AUTOMATED_INTERACTION})}},{key:"setCloseDataAnalytics_",value:function(){return f(f({},this.baseConfigAnalytics_),{},{eventAction:this.getStepVersion_(I.NAV),eventLabel:I.CLOSE})}},{key:"handleCompleteSurveyAnalytics_",value:function(e,t){var n=this.setCompleteDataAnalytics_();this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:n,id:u.a.AUTOMATED_INTERACTION})}},{key:"setCompleteDataAnalytics_",value:function(){return f(f({},this.baseConfigAnalytics_),{},{eventAction:this.getStepVersion_(I.COMPLETE),eventLabel:I.COMPLETE})}},{key:"handlePanelAnalytics_",value:function(){this.indexQuestion_=this.indexQuestionList_[this.panelIndex_]||this.panelIndex_,this.handleStartEventAnalytics_(),this.handleNextEventAnalytics_(),this.handleSelectedInputsAnalytics_()}},{key:"handleStartEventAnalytics_",value:function(){var e=!this.panelIndex_,t=event&&event.target===this.backBtn_,n={eventLabel:I.START_LABEL,eventAction:this.getStepVersion_(I.START)},i=this.baseConfigAnalytics_;t||e&&(i=f(f({},i),n),this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:i,id:u.a.AUTOMATED_INTERACTION}),this.handleLaunchForAnalytics_(1))}},{key:"handleNextEventAnalytics_",value:function(){var e=event.target,t=(this.currentPanelConfig_.ctas.next.action||"").toLowerCase()===I.NEXT&&this.panelIndex_,n=this.setQuestionDataAnalytics_(this.panelIndex_-2,I.NEXT)||{};e===this.nextBtn_&&(t&&this.currentPanelFilled_&&this.handleLaunchForAnalytics_(this.panelIndex_+1),t&&this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:n,id:u.a.AUTOMATED_INTERACTION}))}},{key:"handBackEventAnalytics_",value:function(){var e=this.setQuestionDataAnalytics_(this.panelIndex_+1,I.BACK);this.panelIndex_&&(this.handleLaunchForAnalytics_(this.panelIndex_),e&&this.store_.dispatch(this.topics_.GA_TRACK_EVENT,{data:e,id:u.a.AUTOMATED_INTERACTION}))}},{key:"setQuestionDataAnalytics_",value:function(e,t){var n,i={eventLabel:t,eventAction:""},s=e;return t===I.NEXT&&(s+=2),n=this.indexQuestionList_[s]||s,i.eventAction=this.getStepVersion_(I.NAV),f(f(f({},this.baseConfigAnalytics_),i),{},{indexQuestion:n})}},{key:"enableCurrentInputs_",value:function(){this.currentInputs_.forEach((function(e){e.tabIndex=0}))}},{key:"handlePanelFilled_",value:function(){var e=!0;this.currentInputs_.length&&(e=this.currentInputs_.some((function(e){return!0===e.checked}))),this.currentPanelFilled_=e,e&&this.alertElement_.classList.remove(P.VISIBLE),this.currentPanel_.setAttribute("dataPFilled",e)}},{key:"optoutUser_",value:function(){var e=new Date;e.setUTCMonth(e.getUTCMonth()+this.expireInMonths_);var t=this.getSurveyCookieKey();this.dao_.save(t,"true",e)}},{key:"getSurveyCookieKey",value:function(){var e=Object(o.a)(this.form_.parentElement,"data-android-component-config").data;return(null==e?void 0:e.customCookieKey)||I.OPTOUT}},{key:"valdidateDataTosend_",value:function(){!this.wasSubmitted_&&this.isEnabled_&&(this.wasSubmitted_=!0,this.store_.dispatch(this.topics_.SUBMIT_SURVEY,{id:this.config_.id}))}},{key:"sendData_",value:function(){this.valdidateDataTosend_(),this.formData_=new FormData(this.form_),this.submitData_()}},{key:"submitData_",value:function(){this.xhr_=new XMLHttpRequest,this.xhr_.onreadystatechange=this.handleReadyStateChange_,this.xhr_.open("POST",this.config_.endpoint,!0),this.xhr_.send(this.formData_)}},{key:"handleReadyStateChange_",value:function(){if(this.xhr_&&4===this.xhr_.readyState)if(200===this.xhr_.status)this.optoutUser_(),Object(l.a)(event.target.responseText);else{if(0===this.submitRetries_)throw new _.l;this.submitRetries_--,this.submitData_()}}},{key:"currentOs_",get:function(){var e=null;switch(!0){case this.isIphone_:e=L.IPHONE;break;default:e=L.DEFAULT}return e}},{key:"analyticVersion_",get:function(){var e=O.version[this.currentOs_];return"v".concat(this.version_).concat(e)}}])&&v(t.prototype,n),i&&v(t,i),h}(a.BaseComponent),I={SITE:"site survey",STEP_VIEW:"step view",STEP_COMPLETE:"step complete",NAV:"nav",BACK:"back",CLICK:"click",CLOSE:"close",CLOSED:"closed",LAUNCHED:"launched",NEXT:"next",OPTOUT:"optout-survey",RESPONSE:"response",SURVEY_NAME:"survey",START:"start",START_LABEL:"get started",THANK_YOU:"thank you",COMPLETE:"complete",DECLINE:"decline",OPEN_TEXT_FIELD:"Open Text Field"},P={CENTERED:"centered",FADE:"fade",FULL_HEIGHT:"full-height",HIDDEN:"hidden",SURVEY_UI:"survey-default__ui",VISIBLE:"is-visible"},m={ALERT:".survey-default__alert",BACK:".survey-default__cta-back",COUNTER:".survey-panel__counter",END:"#survey-panel-end",FORM:".survey-default__form",INPUT:"input",NEXT:".survey-default__cta-next",PANEL_VISIBLE:".survey-panel.is-visible",PANEL_CONTAINER:".survey-default__panel-container",PANEL_SUBMITTED_CTA:".survey-panel--end__cta",QUESTIONS:".survey-panel--question",START:"#survey-panel-start",TOTAL:".survey-panel__total-questions-for-os",SURVEY_PANEL:".survey-panel",TEXTAREA:"textarea",FIELD_TEXTAREA:".f-textarea"},L={DEFAULT:"default",IPHONE:"iphone"},O={version:(i={},E(i,L.DEFAULT,"a"),E(i,L.IPHONE,"b"),i)}},87:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={DOWN:40,END:35,ENTER:13,ESC:27,HOME:36,LEFT:37,RIGHT:39,SPACE:32,TAB:9,UP:38}},91:function(e,t,n){"use strict";var i=n(87);n.d(t,"a",(function(){return i.a}))}}]);